#!/usr/bin/env bash

firstline=$(head -n 1 "$1")

shebang()
{
    if [[ "$firstline" =~ ^#! ]]; then
        interpreter=$(echo "$firstline" | sed 's/^#!//')
        spawn st $interpreter $1
        true
    else
        false
    fi
}

type=$(mime "$1")

if [[ "$type" == *audio* ]]; then
    mocp -l "${@}"
elif [[ "$type" == *directory* ]]; then
    spawn st vifm "${@}"
elif [[ "$type" == *djvu* ]]; then
    spawn zathura "${@}"
elif [[ "$type" == *image* ]]; then
    spawn feh "${@}"
elif [[ "$type" == *pdf* ]]; then
    spawn zathura "${@}"
elif [[ "$type" == *shellscript* ]]; then
    shebang "${@}" || spawn st bash "${@}"
elif [[ "$type" == *text* ]]; then
    shebang "${@}" || spawn st vis "${@}"
elif [[ "$type" == *video* ]]; then
    spawn mpv "${@}"
fi
