#!/usr/bin/env bash

file=$(dereference "$1")

shebang()
{
    local header
    header=$(head -n 1 "$file")
    if [[ "$header" =~ ^#! ]]; then
        interpreter=$(echo "$header" | sed 's/^#!//')
        spawn st $interpreter ${@}
        true
    else
        false
    fi
}

type=$(mime "$file")

if [[ "$type" == *audio* ]]; then
    mocp -l "${@}"
elif [[ "$type" == *directory* ]]; then
    spawn st vifm "${@}"
elif [[ "$type" == *djvu* ]]; then
    spawn zathura "${@}"
elif [[ "$type" == *image* ]]; then
    spawn feh "${@}"
elif [[ "$type" == *pdf* ]]; then
    spawn zathura "${@}"
elif [[ "$type" == *shellscript* ]]; then
    shebang "${@}" || spawn st bash "${@}"
elif [[ "$type" == *text* ]]; then
    shebang "${@}" || spawn st vis "${@}"
elif [[ "$type" == *video* ]]; then
    spawn mpv "${@}"
fi
