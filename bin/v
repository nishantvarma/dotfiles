#!/usr/bin/env rc

fn sync {
	if (! git diff --cached --quiet) {
		heading sync
		reply=`{choice 'commit?' 'y,n,u,v,x'}
		switch ($reply) {
		case y Y
			msg=`{prompt 'message' Fixups}
			git commit -m $"msg &&
			if (confirm 'push?')
				git push origin
		case u U
			git reset -p
			sync
		case x X
			git gui
			sync
		case v V
			gitk
			sync
		}
	}
}

heading status
git status -s

new=`{git ls-files --others --exclude-standard}
if (! ~ $#new 0) {
	if (confirm 'add '$#new' new?')
		for (f in $new)
			if (confirm $f'?')
				git add $f
}

if (! git diff --quiet) {
	heading -a stage
	git add -p
}

sync

true
